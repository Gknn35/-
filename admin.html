<!doctype html><html lang="tr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Yönetim — Online</title><link rel="stylesheet" href="assets/css/style.css"></head>
<body class="ready">
<nav class="nav"><div class="container nav-inner"><div class="brand"><img src="assets/img/logo.svg"><span>Yönetim</span></div><div><a class="btn" href="index.html">Siteye dön</a></div></div></nav>
<main class="admin-wrap">
  <div class="panel"><h2>Giriş</h2><div class="row">
    <div><label>Yönetici Şifresi</label><input id="key" class="input" type="password" placeholder="Varsayılan: gokhan123"></div>
    <div style="display:flex;align-items:end"><button class="btnx primary" id="login">Giriş</button></div>
  </div><div class="notice">Şifre, sunucu tarafında kontrol edilir.</div></div>

  <div class="panel"><h2>1) Şarkı Ekle</h2>
    <div class="row3"><div><label>Başlık</label><input id="title" class="input" placeholder="Şarkı adı"></div>
    <div><label>Süre (opsiyonel)</label><input id="dur" class="input" placeholder="3:12"></div>
    <div><label>Sanatçı</label><input id="artist" class="input" value="Gökhan Özkanlı"></div></div>
    <div class="row"><div><label>Kapak (jpg/png/svg)</label><input id="cover" class="input" type="file" accept=".jpg,.jpeg,.png,.svg"></div>
    <div><label>Ses (mp3/wav)</label><input id="audio" class="input" type="file" accept=".mp3,.wav"></div></div>
    <div style="margin-top:10px;display:flex;gap:8px"><button class="btnx primary" id="upload">Yükle ve Ekle</button><button class="btnx" id="reload">Listeyi Yenile</button></div>
    <div id="status" class="notice" style="margin-top:8px"></div>
  </div>

  <div class="panel"><h2>Mevcut Şarkılar</h2><div id="list" class="list"></div></div>
</main>
<script>
let token='';
const $=s=>document.querySelector(s);
$('#login').onclick=()=>{ token=$('#key').value||'gokhan123'; alert('Giriş yapıldı.'); };
$('#reload').onclick=()=>load();
async function toDataUrl(file){
  return new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(file); });
}
$('#upload').onclick=async()=>{
  try{
    $('#status').textContent='Yükleniyor...';
    const title=$('#title').value.trim(); const artist=$('#artist').value.trim(); const duration=$('#dur').value.trim();
    const audio=$('#audio').files[0]; const cover=$('#cover').files[0];
    if(!title||!audio){ alert('Başlık ve ses zorunlu.'); return; }
    const payload={title,artist,duration,
      audio:{name:audio.name,dataUrl:await toDataUrl(audio)},
      cover: cover? {name:cover.name,dataUrl:await toDataUrl(cover)} : null
    };
    const r=await fetch('/.netlify/functions/upload',{method:'POST',headers:{'content-type':'application/json','x-admin-key':token},body:JSON.stringify(payload)});
    if(!r.ok){ const t=await r.text(); throw new Error(t||('HTTP '+r.status)); }
    $('#status').textContent='Eklendi.'; load();
  }catch(e){ $('#status').textContent='Hata: '+e.message; }
};
async function load(){
  const r=await fetch('/.netlify/functions/songs',{cache:'no-store'}); const d=await r.json();
  const ul=$('#list'); ul.innerHTML='';
  (d.songs||[]).forEach(s=>{
    const el=document.createElement('div'); el.className='item';
    el.innerHTML=`<div><b>${s.title}</b> <span class="badge small">${s.duration||''}</span><div class="notice">${s.audio}</div></div>`;
    ul.appendChild(el);
  });
}
load();
</script>
</body></html>
